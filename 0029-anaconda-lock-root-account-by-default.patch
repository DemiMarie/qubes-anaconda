From b6dadacd66565fb62b724f36f1f4124a81d28bf2 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Fr=C3=A9d=C3=A9ric=20Pierret=20=28fepitre=29?=
 <frederic.epitre@orange.fr>
Date: Sat, 10 Nov 2018 19:17:45 +0100
Subject: [PATCH] anaconda: lock root account by default
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Frédéric Pierret (fepitre) <frederic.epitre@orange.fr>
---
 pyanaconda/installclasses/qubes.py | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/pyanaconda/installclasses/qubes.py b/pyanaconda/installclasses/qubes.py
index 28b2a0502..9676ec07d 100644
--- a/pyanaconda/installclasses/qubes.py
+++ b/pyanaconda/installclasses/qubes.py
@@ -19,7 +19,7 @@
 
 from pyanaconda.installclass import BaseInstallClass
 from pyanaconda.modules.common.constants.objects import AUTO_PARTITIONING
-from pyanaconda.modules.common.constants.services import STORAGE, TIMEZONE
+from pyanaconda.modules.common.constants.services import STORAGE, TIMEZONE, USERS
 from pyanaconda.product import *
 from pyanaconda.core.i18n import N_
 import pyanaconda.platform
@@ -65,6 +65,11 @@ class InstallClass(BaseInstallClass):
         timezone_proxy = TIMEZONE.get_proxy()
         timezone_proxy.SetNTPEnabled(False)
 
+        # Make locked root account by default
+        users_proxy = USERS.get_proxy()
+        users_proxy.SetRootAccountLocked(True)
+
+
     def setDefaultPartitioning(self, storage):
         BaseInstallClass.setDefaultPartitioning(self, storage)
         for autoreq in storage.autopart_requests:
-- 
2.20.1

